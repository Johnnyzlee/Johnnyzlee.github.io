<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Timetable</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #999;
      text-align: center;
      padding: 5px;
      min-width: 80px;
      height: 30px;
      word-break: break-all;
    }
    th {
      background-color: #f0f0f0;
    }
    .course {
      background-color: skyblue;
    }
    #notes {
      margin-top: 20px;
      font-size: 14px;
    }
    #notes ul {
      list-style-type: disc;
      margin-left: 20px;
    }
    #notes li {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <!-- Notes Section -->
  <div id="notes">
    <ul>
      <li>
        <strong>MATH 5472</strong>
        <ul>
          <li>Short presentation time is <em>Oct 28, 2025</em> (Tue). Topic 1 chosen: Why do you think statistics is useful.</li>
          <li>Assignment 2 Due is <em>Oct 7 at 11:59pm</em>.</li>
        </ul>
      </li>
      <li>
        <strong>ELEC 1200</strong>
        <ul>
          <li>
            <strong>Lab:</strong> Held only on the following dates (MMDD): <em>0909, 0911, 0916, 0923, 0930, 1104, 1111</em>. Please send the prelab zip file to <a href="mailto:eecupid@ust.hk">eecupid@ust.hk</a> two days in advance (Sun).
          </li>
          <li>
            <strong>Midterm Invigilation:</strong> TBD.
          </li>
          <li>
            <strong>Tutorial:</strong> On <em>0929</em> (Mon) from 12:00 to 12:50 in CYTG009B, need to give an ELEC 1200 T04 tutorial.
          </li>
          <li>
            <strong>Final Invigilation:</strong> TBD.
          </li>
        </ul>
      </li>
      <li>
        <strong>Research</strong>
        <ul>
          <li><a href="https://icc2026.ieee-icc.org/" target="_blank">ICC</a>'s deadline is <em>0929</em>.</li>
          <li>PQE written report's deadline is <em>Oct 11</em> (Sat).</li>
          <li>PQE oral presentation is between <em>Nov 3</em> and <em>Nov 14</em>.</li>
        </ul>
      </li>
      <li>
        <strong>Others</strong>
        <ul>
          <li>ECE TA office hour:
            <ul>
              <li><em>Sep 19</em> (Fri) 14:00-15:00, Rm. 2391 ECE Common Room.</li>
              <li><em>Sep 29</em> (Mon) 14:00-15:00, Rm. 2391 ECE Common Room.</li>
            </ul>
          </li>
          <li>Attend Xinyan & Jingyu's Wedding on <em>Oct 2</em> (Thu) evening, Zhangjiagang.</li>
          <li>Sally Yeh & George Lam Concert at Hung Hom on <em>Oct 11</em> (Sat) 20:15.</li>
          <li>Attend Yun'an & Xuan's Wedding on <em>Nov 30</em> (Sun) noon, Changzhou.</li>
        </ul>
      </li>
    </ul>
  </div>

  <h2>Weekly Timetable</h2>
  <table id="timetable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Monday</th>
        <th>Tuesday</th>
        <th>Wednesday</th>
        <th>Thursday</th>
        <th>Friday</th>
        <th>Saturday</th>
        <th>Sunday</th>
      </tr>
    </thead>
    <tbody>
      <!-- The table body will be generated by JavaScript -->
    </tbody>
  </table>

  <script>
    // Settings
    const startHour = 8;     // 8:00 AM
    const endHour = 23;      // 11:00 PM
    const slotMinutes = 30;  // Each slot is 30 minutes

    // Function to format time as "HH:MM"
    function formatTime(totalMinutes) {
      const h = Math.floor(totalMinutes / 60);
      const m = totalMinutes % 60;
      return (h < 10 ? "0" + h : h) + ":" + (m === 0 ? "00" : m);
    }

    // Generate half-hour time slots starting at 8:00 up to (but not including) 23:00.
    const slots = [];
    const startTotal = startHour * 60;
    const endTotal = endHour * 60;
    for (let t = startTotal; t < endTotal; t += slotMinutes) {
      slots.push(formatTime(t));
    }
    // Note: slots array still contains half-hour increments (e.g., "08:00", "08:30", "09:00", ...)

    // Prepare data structures for merged course cells.
    // For each day (0 = Monday, 1 = Tuesday, ..., 6 = Sunday) we keep track of rows that are occupied.
    const skipped = { 0: {}, 1: {}, 2: {}, 3: {}, 4: {}, 5: {}, 6: {} };

    // For each day, record courses that start at a specific slot.
    const courseMap = { 0: {}, 1: {}, 2: {}, 3: {}, 4: {}, 5: {}, 6: {} };

    // Helper function: Convert "HH:MM" to total minutes.
    function timeToMinutes(timeStr) {
      const parts = timeStr.split(":").map(Number);
      return parts[0] * 60 + parts[1];
    }

    // Helper: Compute the starting slot index relative to 8:00.
    function getStartSlot(timeStr) {
      return Math.floor((timeToMinutes(timeStr) - startTotal) / slotMinutes);
    }

    // Helper: Compute the number of slots (rowSpan) for a course.
    function getRowSpan(startTime, endTime) {
      const diff = timeToMinutes(endTime) - timeToMinutes(startTime);
      return Math.ceil(diff / slotMinutes);
    }

    // Define the courses. Days are represented as 0: Monday, 1: Tuesday, ..., 6: Sunday.
    // Note: For each course, the location field does NOT include the "Rm. " prefix.
    const courses = [
      { days: [3], startTime: "10:00", endTime: "12:00", label: "Group Meeting", location: "" }, 
      { days: [1], startTime: "09:00", endTime: "11:50", label: "ELEC 1200 Lab", location: "2133-2134" },
      // Add MATH 5472 course, Tuesday and Thursday 15:00-16:20, Room 2406, with a hyperlink
      { days: [1, 3], startTime: "15:00", endTime: "16:20", label: "MATH 5472", location: "2406", url: "https://sites.google.com/site/eeyangc/teaching/math-5472-computer-age-statistical-inference-and-its-applications" }
    ];

    // Process each course and populate courseMap and skipped.
    courses.forEach(course => {
      const startSlot = getStartSlot(course.startTime);
      const rowSpan = getRowSpan(course.startTime, course.endTime);
      course.days.forEach(day => {
        // Place the course in courseMap at the start slot, including its URL if available.
        courseMap[day][startSlot] = { rowSpan, label: course.label, location: course.location, url: course.url };
        // Mark subsequent slots as skipped (merged) for that day.
        for (let r = startSlot + 1; r < startSlot + rowSpan; r++) {
          skipped[day][r] = true;
        }
      });
    });

    // Build the table body.
    // Although we still create one row per half-hour slot (for course cells),
    // we merge the time column cells so that one cell covers 2 half-hour rows.
    const tbody = document.querySelector("#timetable tbody");
    for (let i = 0; i < slots.length; i++) {
      const tr = document.createElement("tr");

      // For the left time column, add a cell only on even-indexed rows.
      if (i % 2 === 0) {
        const tdTime = document.createElement("td");
        tdTime.textContent = slots[i]; // Use the label of the first half-hour in the hour
        tdTime.rowSpan = 2;             // Merge two half-hour rows into one cell
        tr.appendChild(tdTime);
      }
      // For odd-indexed rows, the time cell is skipped because it's merged above.

      // Loop through Monday (0) to Sunday (6) for the course cells.
      for (let day = 0; day < 7; day++) {
        // If this slot is part of a merged course cell, skip creating a cell.
        if (skipped[day][i]) {
          continue;
        }
        // Check if a course starts at this slot for this day.
        if (courseMap[day][i]) {
          const course = courseMap[day][i];
          const tdCourse = document.createElement("td");
          tdCourse.className = "course";
          // If a URL is provided, wrap the course label in a hyperlink.
          let labelContent = course.label;
          if (course.url) {
            labelContent = `<a href="${course.url}" target="_blank">${course.label}</a>`;
          }
          // If a location is provided, display it on a new line with "Rm. " prefixed.
          if (course.location) {
            tdCourse.innerHTML = labelContent + "<br>" + "Rm. " + course.location;
          } else {
            tdCourse.innerHTML = labelContent;
          }
          tdCourse.rowSpan = course.rowSpan;
          tr.appendChild(tdCourse);
        } else {
          // Otherwise, create an empty cell.
          const td = document.createElement("td");
          tr.appendChild(td);
        }
      }
      tbody.appendChild(tr);
    }
  </script>
</body>
</html>